<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="icon" href="https://res.cloudinary.com/comixall/image/upload/favicon/favicon.ico" type="image/x-icon">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/admin.css">
</head>

<body>
    <div id="auth-container" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h2>Admin Login</h2>
            </div>
            <div class="auth-body">
                <div id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" class="form-control" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-control"
                            placeholder="Enter your password">
                    </div>
                    <button id="login-btn" class="btn btn-primary btn-block">
                        <span id="login-spinner" class="loading-spinner hidden"></span>
                        <span id="login-text">Login</span>
                    </button>
                    <p id="login-error" class="error-message"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="admin-dashboard" class="admin-container hidden">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-book-open"></i> <span>ComixAll</span></h2>
            </div>
            <div class="sidebar-menu">
                <a href="#" class="menu-item active" data-section="dashboard"><i
                        class="fas fa-home"></i><span>Dashboard</span></a>
                <a href="#" class="menu-item" data-section="comics"><i class="fas fa-book"></i><span>Comics</span></a>
                <a href="#" class="menu-item" data-section="categories"><i
                        class="fas fa-tags"></i><span>Categories</span></a>
                <a href="#" class="menu-item" data-section="users"><i class="fas fa-users"></i><span>Users</span></a>
                <a href="#" class="menu-item" data-section="settings"><i
                        class="fas fa-cog"></i><span>Settings</span></a>
            </div>
        </div>

        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <div class="main-content">
            <header class="header">
                <button class="mobile-menu-btn" id="mobile-menu-btn"><i class="fas fa-bars"></i></button>
                <h1 id="section-title">Dashboard</h1>
                <div class="user-profile">
                    <button class="theme-toggle-btn" id="theme-toggle-btn" title="Toggle Theme"><i
                            class="fas fa-moon"></i></button>
                    <img id="user-profile-img"
                        src="https://ui-avatars.com/api/?name=Admin&background=4A55A2&color=fff&font-size=0.5"
                        alt="Admin" title="Change Profile Picture">
                    <button class="logout-btn" id="logout-btn" title="Logout"><i
                            class="fas fa-sign-out-alt"></i></button>
                </div>
            </header>

            <div id="dashboard-section" class="section-content">
                <div class="stats-container">
                    <div class="stat-card" style="--i: 1;">
                        <div class="stat-title">Total Comics</div>
                        <div class="stat-value" id="total-comics">0</div>
                    </div>
                    <div class="stat-card" style="--i: 2;">
                        <div class="stat-title">Total Users</div>
                        <div class="stat-value" id="active-users">0</div>
                    </div>
                    <div class="stat-card" style="--i: 3;">
                        <div class="stat-title">Total Views</div>
                        <div class="stat-value" id="page-views">0</div>
                    </div>
                    <div class="stat-card" style="--i: 4;">
                        <div class="stat-title">Storage Used</div>
                        <div class="stat-value" id="storage-used">N/A</div>
                    </div>
                </div>

                <div class="form-card" style="margin-top: 2rem; --i: 5;">
                    <div class="card-header">
                        <h2>Recent Activity</h2>
                        <button id="delete-all-activities-btn" class="btn btn-danger btn-sm">Delete All</button>
                    </div>
                    <div id="recent-activity-list">
                        <p>Loading recent activity...</p>
                    </div>
                </div>
            </div>

            <div id="comics-section" class="section-content">
                <div class="form-card" style="--i: 1;">
                    <h2>Add New Comic</h2>
                    <form id="comic-form">
                        <div class="form-row">
                            <div class="form-group"><label for="comic-title">Title</label><input type="text"
                                    id="comic-title" class="form-control" placeholder="e.g., Marvel" required></div>
                            <div class="form-group"><label for="comic-author">Author</label><input type="text"
                                    id="comic-author" class="form-control" placeholder="e.g., IronMan" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label for="comic-folder">Cloudinary Folder Name</label><input
                                    type="text" id="comic-folder" class="form-control" placeholder="e.g., Marvel_Comics"
                                    required></div>
                            <div class="form-group"><label for="comic-category">Category</label><select
                                    id="comic-category" class="form-control" required>
                                    <option value="">Loading categories...</option>
                                </select></div>
                        </div>
                        <div class="form-group"><label for="comic-tags">Tags (comma-separated)</label><input type="text"
                                id="comic-tags" class="form-control" placeholder="e.g., Action, Suspence, Thriller">
                        </div>
                        <div class="form-group"><label>Thumbnail</label><input type="url" id="comic-thumbnail"
                                class="form-control" placeholder="Paste Cloudinary image URL here" required></div>
                        <div class="form-group"><label for="comic-description">Description</label><textarea
                                id="comic-description" class="form-control"
                                placeholder="A brief summary of the comic..."></textarea></div>
                        <div class="form-group">
                            <label for="comic-manifest-url">Manifest JSON URL</label>
                            <input type="url" id="comic-manifest-url" class="form-control"
                                placeholder="Paste GitHub Gist Raw URL here" required>
                        </div>
                        <div class="form-actions">
                            <button type="reset" class="btn btn-outline">Clear</button>
                            <button type="submit" id="submit-comic" class="btn btn-primary"><span id="submit-spinner"
                                    class="loading-spinner hidden"></span><span id="submit-text">Add
                                    Comic</span></button>
                        </div>
                    </form>
                </div>
                <div class="form-card" style="--i: 2;">
                    <div class="header">
                        <h2>Comics Library</h2>
                        <div class="form-group" style="margin-bottom: 0;"><input type="text" id="search-comics"
                                class="form-control" placeholder="Search comics..."></div>
                    </div>
                    <div id="admin-comics-grid" class="comics-grid"></div>
                </div>
            </div>

            <div id="categories-section" class="section-content">
                <div class="form-card" style="--i: 1;">
                    <h2>Add New Category</h2>
                    <form id="category-form" style="display: flex; gap: 1rem; align-items: center;">
                        <div class="form-group" style="flex-grow: 1; margin-bottom: 0;">
                            <label for="category-name-input" class="hidden">Category Name</label>
                            <input type="text" id="category-name-input" class="form-control"
                                placeholder="Enter new category name (e.g., Parody)" required>
                        </div>
                        <button type="submit" id="add-category-btn" class="btn btn-primary">Add Category</button>
                    </form>
                </div>
                <div class="form-card" style="--i: 2;">
                    <h2>Existing Categories</h2>
                    <ul id="categories-list-admin" class="category-admin-list"></ul>
                </div>
            </div>

            <div id="users-section" class="section-content"
                style="display: none; flex-direction: column; align-items: center; justify-content: center;"><i
                    class="fas fa-users-cog" style="font-size: 3rem; color: var(--text-gray); margin-bottom: 1rem;"></i>
                <h2>User Management</h2>
                <p style="color: var(--text-gray);">This feature is under construction.</p>
            </div>

            <div id="settings-section" class="section-content">
                <div class="form-card">
                    <h2>Settings</h2>
                    <div class="settings-item">
                        <div class="settings-item-label">
                            <h3>Dark Mode</h3>
                            <p>Toggle the dashboard's color scheme.</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="dark-mode-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <div class="settings-item-label">
                            <h3>Clear Cache</h3>
                            <p>Clear temporary data stored in your browser.</p>
                        </div>
                        <button id="clear-cache-btn" class="btn btn-outline">Clear</button>
                    </div>
                    <div class="settings-item">
                        <div class="settings-item-label">
                            <h3>Backup Data</h3>
                            <p>Download a backup of your Firestore data.</p>
                        </div>
                        <button id="backup-data-btn" class="btn btn-outline">
                            <span class="loading-spinner hidden"></span>
                            <span>Backup</span>
                        </button>
                    </div>
                    <div class="settings-item">
                        <div class="settings-item-label">
                            <h3>Restore Data</h3>
                            <p>Restore data from a backup file.</p>
                        </div>
                        <button id="restore-data-btn" class="btn btn-outline">
                            <span class="loading-spinner hidden"></span>
                            <span>Restore</span>
                        </button>
                        <input type="file" id="restore-file-input" class="hidden" accept=".zip">
                    </div>
                    <div class="settings-item">
                        <div class="settings-item-label">
                            <h3>Logout</h3>
                            <p>Sign out of the admin dashboard.</p>
                        </div>
                        <button id="settings-logout-btn" class="btn btn-danger">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toast-container"></div>

    <div class="modal" id="delete-modal">
        <div class="modal-content" style="max-width: 500px">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Deletion</h3><button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this comic and all its parts? This action cannot be undone.</p>
            </div>
            <div class="modal-footer"><button class="btn btn-outline" id="cancel-delete">Cancel</button><button
                    class="btn btn-danger" id="confirm-delete">Delete</button></div>
        </div>
    </div>

    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Comic</h3><button class="modal-close"
                    id="edit-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-comic-form">
                    <input type="hidden" id="edit-comic-id">
                    <div class="form-group"><label for="edit-comic-title">Title</label><input type="text"
                            id="edit-comic-title" class="form-control" required></div>
                    <div class="form-row">
                        <div class="form-group"><label for="edit-comic-author">Author</label><input type="text"
                                id="edit-comic-author" class="form-control" required></div>
                        <div class="form-group"><label for="edit-comic-folder">Cloudinary Folder</label><input
                                type="text" id="edit-comic-folder" class="form-control" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label for="edit-comic-category">Category</label><select
                                id="edit-comic-category" class="form-control" required></select></div>
                        <div class="form-group"><label for="edit-comic-tags">Tags</label><input type="text"
                                id="edit-comic-tags" class="form-control"></div>
                    </div>
                    <div class="form-group"><label for="edit-comic-thumbnail">Thumbnail URL</label><input type="url"
                            id="edit-comic-thumbnail" class="form-control" required></div>
                    <div class="form-group"><label for="edit-comic-description">Description</label><textarea
                            id="edit-comic-description" class="form-control"></textarea></div>
                    <div class="form-group">
                        <label for="edit-comic-manifest-url">Manifest JSON URL</label>
                        <input type="url" id="edit-comic-manifest-url" class="form-control" required>
                    </div>
                    <div class="parts-management-section">
                        <h4 style="margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem;">
                            Part Name Overrides</h4>
                        <p style="font-size: 0.85rem; color: var(--text-gray); margin-bottom: 1rem;">Yahan naam daalne
                            se default naam ('Comic Title - Part X') ki jagah aapka diya hua naam dikhega. Box khaali
                            chhodne par default naam istemal hoga.</p>
                        <div id="part-overrides-container"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="delete-from-modal-btn"
                    style="margin-right: auto;">Delete Comic</button>
                <button type="button" class="btn btn-outline" id="cancel-edit">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-edit">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal" id="pfp-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Change Profile Picture</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <h4>Select a Preset Avatar</h4>
                <div id="preset-avatars-grid" class="preset-avatars-grid"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-pfp-change">Cancel</button>
                <button class="btn btn-primary hidden" id="save-pfp-btn">
                    <span class="loading-spinner hidden"></span>
                    <span>Save Changes</span>
                </button>
            </div>
        </div>
    </div>

    <script src="js/admin.js"></script>
</body>

</html>